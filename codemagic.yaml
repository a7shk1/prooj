workflows:
  ios-app:
    name: iOS App
    max_build_duration: 60
    environment:
      flutter: stable
      xcode: latest
    scripts:
      - name: Get Flutter packages
        script: flutter pub get

      - name: Build iOS IPA (unsigned)
        script: flutter build ipa --release --no-codesign

      # ğŸ‘‡ Ø§Ø³ØªÙƒØ´Ø§Ù + Ù†Ø³Ø® Ù…Ù„Ù Ø§Ù„Ù€ IPA Ù„Ù…Ø¬Ù„Ø¯ artifacts Ø¨Ø¶Ù…Ø§Ù†
      - name: Collect IPA
        script: |
          echo "ğŸ” Listing build outputs..."
          ls -R build/ios || true
          echo "ğŸ” Searching for any .ipa file..."
          IPA_PATH=$(find build -name "*.ipa" | head -n1)
          if [ -z "$IPA_PATH" ]; then
            echo "âŒ No IPA found!" && exit 1
          fi
          echo "âœ… Found IPA at: $IPA_PATH"
          mkdir -p artifacts
          cp "$IPA_PATH" artifacts/VAR-IPTV.ipa
          echo "ğŸ“¦ Copied to artifacts/VAR-IPTV.ipa"

    artifacts:
      - artifacts/VAR-IPTV.ipa
